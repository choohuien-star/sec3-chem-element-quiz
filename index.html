<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chemistry Personality Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --magnesium: #fbbf24;
            --carbon: #94a3b8;
            --argon: #818cf8;
            --copper: #f97316;
            --bg-deep: #020617;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-deep);
            background-image: 
                linear-gradient(to bottom, rgba(2, 6, 23, 0.8), rgba(2, 6, 23, 0.95)),
                url('https://www.transparenttextures.com/patterns/carbon-fibre.png');
            color: #f8fafc;
            overflow-x: hidden;
            min-height: screen;
        }

        /* Periodic Table Grid Background */
        .periodic-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(99, 102, 241, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(99, 102, 241, 0.05) 1px, transparent 1px);
            background-size: 50px 50px;
            z-index: -1;
        }

        .periodic-bg::after {
            content: "";
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 50% 50%, transparent 0%, var(--bg-deep) 80%);
        }

        /* Neon Glow Orbs */
        .glow {
            position: fixed;
            width: 40vw;
            height: 40vw;
            border-radius: 50%;
            filter: blur(120px);
            z-index: -1;
            opacity: 0.15;
            animation: pulse 10s infinite alternate;
        }

        @keyframes pulse {
            0% { transform: scale(1) translate(0, 0); opacity: 0.1; }
            100% { transform: scale(1.2) translate(5%, 5%); opacity: 0.2; }
        }

        .glass-card {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .option-card {
            background: rgba(30, 41, 59, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .option-card:hover {
            transform: scale(1.02);
            background: rgba(99, 102, 241, 0.1);
            border-color: rgba(99, 102, 241, 0.5);
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.2);
        }

        .btn-neon {
            background: #6366f1;
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.5);
            transition: all 0.3s ease;
        }

        .btn-neon:hover {
            box-shadow: 0 0 30px rgba(99, 102, 241, 0.8);
            transform: translateY(-2px);
        }

        .progress-glow {
            box-shadow: 0 0 10px rgba(99, 102, 241, 0.8);
        }

        /* Result Colors */
        .res-Magnesium { color: #fbbf24; text-shadow: 0 0 20px rgba(251, 191, 36, 0.4); }
        .res-Carbon { color: #f1f5f9; text-shadow: 0 0 20px rgba(255, 255, 255, 0.3); }
        .res-Argon { color: #818cf8; text-shadow: 0 0 20px rgba(129, 140, 248, 0.4); }
        .res-Copper { color: #fb923c; text-shadow: 0 0 20px rgba(251, 146, 60, 0.4); }

        .loader {
            width: 18px;
            height: 18px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-top-color: #6366f1;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div class="periodic-bg"></div>
    <div class="glow bg-indigo-500 top-0 left-0"></div>
    <div class="glow bg-blue-600 bottom-0 right-0" style="animation-delay: -5s;"></div>

    <div id="app" class="w-full max-w-lg">
        
        <!-- Screen 1: Welcome -->
        <div id="screen-welcome" class="glass-card rounded-[2.5rem] p-10 text-center animate-in fade-in duration-700">
            <h1 class="text-4xl font-black tracking-tight mb-3 bg-clip-text text-transparent bg-gradient-to-b from-white to-slate-400 uppercase">
                WHICH ELEMENT ARE YOU?
            </h1>
            <p class="text-slate-400 mb-10 text-lg font-medium">Discover your chemical persona and identify your core traits.</p>
            
            <div class="space-y-4 mb-8">
                <input type="text" id="input-name" placeholder="Full Name" class="w-full bg-slate-900/50 p-4 pl-6 rounded-2xl border border-white/10 focus:ring-4 focus:ring-indigo-500/20 focus:border-indigo-500 outline-none transition-all placeholder:text-slate-600 font-bold text-white">
                <input type="text" id="input-class" placeholder="Class (e.g., S3-01)" class="w-full bg-slate-900/50 p-4 pl-6 rounded-2xl border border-white/10 focus:ring-4 focus:ring-indigo-500/20 focus:border-indigo-500 outline-none transition-all placeholder:text-slate-600 font-bold text-white">
            </div>
            
            <button onclick="startQuiz()" class="btn-neon w-full text-white font-black py-5 rounded-2xl active:scale-[0.98] text-lg uppercase tracking-widest">
                Initiate Reaction
            </button>
            
            <button onclick="toggleTeacherLogin()" class="mt-8 text-slate-500 text-xs hover:text-indigo-400 transition-colors uppercase tracking-widest font-bold">
                Supervisor Override
            </button>
        </div>

        <!-- Screen 2: Quiz -->
        <div id="screen-quiz" class="glass-card rounded-[2.5rem] p-10 hidden">
            <div class="flex items-center gap-4 mb-10">
                <div class="flex-1 h-2 bg-slate-800 rounded-full overflow-hidden">
                    <div id="progress-bar" class="progress-glow h-full bg-indigo-500 rounded-full transition-all duration-700"></div>
                </div>
                <span id="progress-text" class="text-[10px] font-black text-indigo-400 tracking-[0.2em] uppercase">Q1 / 6</span>
            </div>
            
            <h2 id="question-text" class="text-2xl font-bold mb-10 text-white leading-tight"></h2>
            
            <div id="options-container" class="space-y-4"></div>
        </div>

        <!-- Screen 3: Result -->
        <div id="screen-result" class="glass-card rounded-[2.5rem] p-0 overflow-hidden hidden">
            <div id="result-visual" class="p-16 text-center relative border-b border-white/10">
                <div class="relative z-10">
                    <p class="text-indigo-400 font-black uppercase tracking-[0.3em] text-[10px] mb-4">Classification Complete</p>
                    <h1 id="result-element" class="text-7xl font-black mb-4 tracking-tighter"></h1>
                    <div id="element-symbol" class="inline-block px-4 py-1 border-2 rounded-lg font-black text-sm mb-4"></div>
                </div>
                <div class="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]"></div>
            </div>
            
            <div class="p-10 text-center">
                <p id="result-description" class="text-base text-slate-300 leading-relaxed mb-8 font-medium italic"></p>
                
                <div id="submission-status" class="bg-indigo-500/10 rounded-2xl py-4 px-6 inline-flex items-center gap-3 mb-8 border border-indigo-500/20">
                    <div class="loader" id="submit-loader"></div>
                    <span id="status-text" class="text-xs font-bold text-indigo-300 uppercase tracking-widest">Syncing Data...</span>
                </div>

                <button onclick="location.reload()" class="block w-full text-slate-500 font-bold hover:text-white transition-colors text-sm uppercase tracking-widest">Restart Analysis</button>
            </div>
        </div>

        <!-- Screen 4: Teacher Dashboard -->
        <div id="screen-dashboard" class="glass-card rounded-[2.5rem] p-10 hidden w-full max-w-4xl fixed inset-4 md:inset-auto overflow-y-auto">
            <div class="flex justify-between items-center mb-10">
                <div>
                    <h2 class="text-2xl font-black text-white uppercase">Registry</h2>
                    <p class="text-slate-500 text-sm">Real-time student classification data</p>
                </div>
                <div class="flex gap-4">
                    <button onclick="downloadCSV()" class="bg-emerald-600 hover:bg-emerald-500 text-white font-bold py-2 px-6 rounded-xl transition-all text-xs uppercase tracking-widest">Export</button>
                    <button onclick="location.reload()" class="bg-slate-800 text-white font-bold py-2 px-6 rounded-xl text-xs uppercase tracking-widest">Exit</button>
                </div>
            </div>
            
            <div class="rounded-2xl border border-white/5 overflow-hidden">
                <table class="w-full text-left">
                    <thead class="bg-slate-900/50">
                        <tr class="text-slate-500 text-[10px] uppercase tracking-widest font-black border-b border-white/5">
                            <th class="p-5">Name</th>
                            <th class="p-5">Class</th>
                            <th class="p-5 text-center">Persona</th>
                        </tr>
                    </thead>
                    <tbody id="dashboard-table-body" class="text-sm divide-y divide-white/5 bg-slate-900/20">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Teacher Login -->
        <div id="screen-teacher-login" class="glass-card rounded-[2.5rem] p-10 text-center hidden fixed inset-x-4 top-1/4 max-w-sm mx-auto z-50 shadow-2xl border-indigo-500/30">
            <h2 class="text-lg font-black text-white mb-6 uppercase tracking-widest">Access Key Required</h2>
            <input type="password" id="teacher-password" class="w-full bg-slate-950 p-4 rounded-xl border border-white/10 mb-6 focus:border-indigo-500 outline-none text-center text-white text-lg tracking-[0.5em]">
            <div class="flex gap-3">
                <button onclick="showScreen('screen-welcome')" class="flex-1 text-slate-500 font-bold py-3 text-xs uppercase">Cancel</button>
                <button onclick="checkTeacherPassword()" class="flex-1 bg-indigo-600 text-white font-bold py-3 rounded-xl text-xs uppercase tracking-widest">Authorize</button>
            </div>
        </div>

    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycby38ac_GouEKkhe4Pqg5YFp3c58oHzQdnK3DwDjH89RxhiuvfUz1ko9zAyqJpP3IlDf4w/exec";

        const questions = [
            {
                text: "How did you feel about your previous Science performance?",
                options: [
                    { text: "Total mastery. Ready for higher-level reactions.", element: "Magnesium" },
                    { text: "Versatile. I found creative paths to the answers.", element: "Carbon" },
                    { text: "Stable. I maintained a consistent, high standard.", element: "Argon" },
                    { text: "Collaborative. I thrived in peer-to-peer learning.", element: "Copper" }
                ]
            },
            {
                text: "A complex project is due tomorrow. What is your protocol?",
                options: [
                    { text: "Early completion. I lead the pace for the group.", element: "Magnesium" },
                    { text: "Optimizing. I'm restructuring the work for clarity.", element: "Carbon" },
                    { text: "Verification. I'm checking every variable for errors.", element: "Argon" },
                    { text: "Communication. I'm syncing conclusions with my team.", element: "Copper" }
                ]
            },
            {
                text: "The results are unexpected. How do you respond?",
                options: [
                    { text: "Initiate. I immediately test a new hypothesis.", element: "Magnesium" },
                    { text: "Adapt. I find a new way to interpret the situation.", element: "Carbon" },
                    { text: "Observe. I calmly analyze the root cause.", element: "Argon" },
                    { text: "Discuss. I consult with others to find a solution.", element: "Copper" }
                ]
            },
            {
                text: "What describes your contribution to a group project?",
                options: [
                    { text: "The Kinetic Energy - I provide the drive.", element: "Magnesium" },
                    { text: "The Structural Bond - I hold the ideas together.", element: "Carbon" },
                    { text: "The Inertia - I keep us calm under pressure.", element: "Argon" },
                    { text: "The Conductor - I make sure everyone is connected.", element: "Copper" }
                ]
            },
            {
                text: "A new, difficult theory is introduced. Your first thought?",
                options: [
                    { text: "I want to be the first to master it.", element: "Magnesium" },
                    { text: "How does this connect to our previous knowledge?", element: "Carbon" },
                    { text: "I need to see the proof and logic behind it.", element: "Argon" },
                    { text: "Let's work through this example together.", element: "Copper" }
                ]
            },
            {
                text: "If you were a lab component, which would you be?",
                options: [
                    { text: "The Ignition Source - Providing the spark.", element: "Magnesium" },
                    { text: "The Allotrope - Changing form to fit the need.", element: "Carbon" },
                    { text: "The Vacuum Chamber - Completely undisturbed.", element: "Argon" },
                    { text: "The Circuitry - Flowing information to all points.", element: "Copper" }
                ]
            }
        ];

        const elementData = {
            Magnesium: {
                title: "Magnesium",
                symbol: "Mg (12)",
                desc: "High Kinetic energy. You bring a brilliant spark to any environment. You are proactive and a natural catalyst who drives progress with intense momentum.",
                color: "#fbbf24"
            },
            Carbon: {
                title: "Carbon",
                symbol: "C (6)",
                desc: "Infinite Versatility. You are adaptable and creative, capable of forming complex connections. You link diverse ideas into a single, stable structure.",
                color: "#f8fafc"
            },
            Argon: {
                title: "Argon",
                symbol: "Ar (18)",
                desc: "Noble Stability. You are the calm center of the group. Thoughtful and highly dependable, you remain unreactive to stress while others lose focus.",
                color: "#818cf8"
            },
            Copper: {
                title: "Copper",
                symbol: "Cu (29)",
                desc: "Universal Conductor. You excel at the flow of information. You facilitate communication and provide the essential support for the team to function.",
                color: "#fb923c"
            }
        };

        let currentQuestion = 0;
        let userData = { name: "", class: "", answers: [], element: "" };
        let scores = { Magnesium: 0, Carbon: 0, Argon: 0, Copper: 0 };
        let allSubmissions = [];

        function showScreen(id) {
            document.querySelectorAll('#app > div').forEach(div => div.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        function startQuiz() {
            userData.name = document.getElementById('input-name').value.trim();
            userData.class = document.getElementById('input-class').value.trim();
            if (!userData.name || !userData.class) return alert("Identification Required.");
            showScreen('screen-quiz');
            loadQuestion();
        }

        function loadQuestion() {
            const q = questions[currentQuestion];
            document.getElementById('question-text').innerText = q.text;
            document.getElementById('progress-text').innerText = `Q${currentQuestion + 1} / ${questions.length}`;
            document.getElementById('progress-bar').style.width = `${((currentQuestion + 1) / questions.length) * 100}%`;

            const container = document.getElementById('options-container');
            container.innerHTML = '';

            q.options.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = "option-card w-full text-left p-5 rounded-2xl font-bold text-slate-300 flex items-center gap-4 group";
                btn.innerHTML = `
                    <span class="w-8 h-8 rounded-lg bg-slate-800 flex items-center justify-center text-[10px] text-indigo-400 border border-white/5 group-hover:border-indigo-500/50">${idx + 1}</span>
                    <span class="flex-1">${opt.text}</span>
                `;
                btn.onclick = () => {
                    scores[opt.element]++;
                    userData.answers.push(opt.text);
                    if (++currentQuestion < questions.length) loadQuestion(); else calculateResult();
                };
                container.appendChild(btn);
            });
        }

        function calculateResult() {
            userData.element = Object.entries(scores).reduce((a, b) => b[1] > a[1] ? b : a)[0];
            const data = elementData[userData.element];
            const el = document.getElementById('result-element');
            el.innerText = data.title;
            el.className = `text-7xl font-black mb-4 tracking-tighter res-${userData.element}`;
            
            const sym = document.getElementById('element-symbol');
            sym.innerText = data.symbol;
            sym.style.borderColor = data.color;
            sym.style.color = data.color;
            sym.style.boxShadow = `0 0 15px ${data.color}44`;

            document.getElementById('result-description').innerText = data.desc;
            showScreen('screen-result');
            submitData();
        }

        async function submitData() {
            if (SCRIPT_URL.includes("PASTE_GOOGLE_APPS_SCRIPT")) {
                document.getElementById('status-text').innerText = "Dev Mode: Data not saved";
                document.getElementById('submit-loader').style.display = 'none';
                return;
            }
            try {
                const payload = { timestamp: new Date().toLocaleString(), name: userData.name, class: userData.class, answers: userData.answers.join("|"), element: userData.element };
                await fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(payload) });
                document.getElementById('status-text').innerText = "Sync Complete";
                document.getElementById('submit-loader').innerHTML = 'âœ“';
                document.getElementById('submit-loader').style.animation = 'none';
            } catch (e) {
                document.getElementById('status-text').innerText = "Sync Failed";
            }
        }

        function toggleTeacherLogin() { showScreen('screen-teacher-login'); }
        function checkTeacherPassword() {
            if (document.getElementById('teacher-password').value === 'ilovechemistry') {
                showScreen('screen-dashboard');
                fetchTeacherData();
            } else alert("Invalid Key");
        }

        async function fetchTeacherData() {
            if (SCRIPT_URL.includes("PASTE_GOOGLE_APPS_SCRIPT")) return;
            try {
                const res = await fetch(SCRIPT_URL);
                allSubmissions = await res.json();
                const tbody = document.getElementById('dashboard-table-body');
                tbody.innerHTML = allSubmissions.map(r => `
                    <tr class="hover:bg-white/5 transition-colors">
                        <td class="p-5 font-bold text-white">${r.name}</td>
                        <td class="p-5 text-slate-500 font-bold">${r.class}</td>
                        <td class="p-5 text-center">
                            <span class="px-3 py-1 rounded-md text-[9px] font-black uppercase text-black" style="background: ${elementData[r.element]?.color || '#94a3b8'}">${r.element}</span>
                        </td>
                    </tr>
                `).join('');
            } catch (e) {
                document.getElementById('dashboard-table-body').innerHTML = '<tr><td colspan="3" class="p-10 text-center text-red-500">Registry Error</td></tr>';
            }
        }

        function downloadCSV() {
            if (!allSubmissions.length) return;
            const headers = Object.keys(allSubmissions[0]).join(',');
            const rows = allSubmissions.map(r => Object.values(r).map(v => `"${v}"`).join(',')).join('\n');
            const blob = new Blob([headers + '\n' + rows], { type: 'text/csv' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `Registry_Results.csv`;
            a.click();
        }
    </script>
</body>
</html>
